STDARG(3) - Library Functions Manual

# NAME

**`stdarg`** - переменные списки аргументов

# SYNOPSIS
```c
#include <stdarg.h>

void	va_start(va_list ap, last);

type	va_arg(va_list ap, type);

void	va_copy(va_list dest, va_list src);

void	va_end(va_list ap);
```
# DESCRIPTION

Функция может быть вызвана с переменным числом аргументов разных типов. Включаемый файл <*`stdarg.h`*> объявляет тип (*`va_list`*) и определяет три макроса для перехода по списку аргументов, число и типы которых неизвестны вызываемой функции.

Вызываемая функция должна объявить объект типа *`va_list`*, который используется макросами **`va_start`**(), **`va_arg`** (), **`va_copy`**(), и **`va_end`**().

Макрос **`va_start`**() должен быть вызван первым, и он инициализирует *`ap`*, который может быть передан в **`va_arg`**() для каждого аргумента, который будет обработан. Вызов **`va_end`**() сигнализирует об отсутствии дальнейших аргументов и приводит к тому, что *`ap`* становится недействительным. Обратите внимание, что каждый вызов **`va_start`**() должен соответствовать вызову **`va_end`**() из одной и той же функции.

Параметр *`last`* - это имя последнего параметра перед списком аргументов переменной, т. Е. Последний параметр, для которого вызывающая функция знает тип.

Поскольку адрес этого параметра используется в макросе **`va_start`**(), его не следует объявлять как переменную регистра, как функцию или тип массива.

Макрос **`va_arg`**() расширяется до выражения, которое имеет тип и значение следующего аргумента в вызове. Параметр *`ap`* - это *`va_list`* *`ap`*, инициализированный **`va_start`**(). Каждый вызов **`va_arg`**() изменяет *`ap`*, так что следующий вызов возвращает следующий аргумент. Параметр *`type`* - это имя типа, указанное таким образом, что тип указателя на объект, имеющий указанный тип, можно получить, просто добавив \* к *`type`*.

Если следующего аргумента нет или *`type`* несовместим с типом фактического следующего аргумента (как продвигается в соответствии с продвижением аргумента по умолчанию), произойдут случайные ошибки.

Первое использование макроса **`va_arg`**() после использования макроса **`va_start`**() возвращает аргумент после *`last`*. Последовательные вызовы возвращают значения оставшихся аргументов.

Макрос **`va_copy`**() копирует состояние списка аргументов переменной, *`src`*, ранее инициализированного **`va_start`**(), в список аргументов переменной, *`dest`*, который не должен быть предварительно инициализирован **`va_start`**(), без промежуточного вызова **`va_end`**(). Состояние, сохраненное в *`dest`*, эквивалентно вызову **`va_start`**() и **`va_arg`**() для *`dest`* таким же образом, как это было использовано в *`src`*. Скопированный список аргументов переменной может впоследствии быть передан в **`va_arg`**(), и, наконец, должен быть передан в **`va_end`**(), когда закончится с ним.

После того, как список переменных-переменных признан недействительным **`va_end`**(), его можно повторно инициализировать с помощью **`va_start`**() или создать копию списка других переменных-переменных с помощью **`va_copy`**().

# ПРИМЕРЫ

Функция *`foo`* принимает строку символов формата и выводит аргумент, связанный с каждым символом формата, в зависимости от типа.
```c
	void foo(char *fmt, ...)
	{
		va_list ap, ap2;
		int d;
		char c, *s;
	
		va_start(ap, fmt);
		va_copy(ap2, ap);
		while (*fmt)
			switch(*fmt++) {
			case 's':			/* string */
				s = va_arg(ap, char *);
				printf("string %s\n", s);
				break;
			case 'd':			/* int */
				d = va_arg(ap, int);
				printf("int %d\n", d);
				break;
			case 'c':			/* char */
				/* Note: char is promoted to int. */
				c = va_arg(ap, int);
				printf("char %c\n", c);
				break;
			}
		va_end(ap);
		...
		/* use ap2 to iterate over the arguments again */
		...
		va_end(ap2);
	}
```
# СОВМЕСТИМОСТЬ

Эти макросы *`не совместимы`* с историческими макросами, которые они заменяют. Обратно-совместимую версию можно найти во включаемом файле <*`varargs.h`*>.

# СТАНДАРТЫ

Макросы **`va_start`**(), **`va_arg`**(), **`va_copy`**(), и **`va_end`**() соответсвуют ISO/IEC 9899:1999 (&#8220;ISO&#160;C99&#8221;).

# ОШИБКИ

В отличие от макросов *`varargs`*, макросы **`stdarg`** не позволяют программистам кодировать функцию без фиксированных аргументов. Эта проблема генерирует работу главным образом при преобразовании кода *`varargs`* в код **`stdarg`**, но также создает трудности для функций с переменным числом, которые хотят передать все свои аргументы в функцию, которая принимает *`va_list`* аргумент, такой как vfprintf(3).

Mac OS X 10.12 - October 25, 2002
